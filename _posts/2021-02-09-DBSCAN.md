---
layout: post
title: "[ML/Stat]A Density-Based Algorithm for Discovering Clusters"
categories: docs
tags: ['ml', 'stat']
comments: true
use_math: true
---

*A Density-Based Algorithm for Discovering Clusters(1996)* μ„ μ½κ³  κ³µλ¶€ν• λ‚΄μ©μ…λ‹λ‹¤ π


# 1. Intro

μƒλ€μ μΌλ΅ ν° κ³µκ°„ λ°μ΄ν„°μ— μ ν•©ν• ν΄λ¬μ¤ν„°λ§ μ•κ³ λ¦¬μ¦ **DBSCAN** μ„ μ μ•ν•λ‹¤. DBSCAN μ μ¥μ μ€ λ‹¤μκ³Ό κ°™λ‹¤. μ²«μ§Έ, DBSCAN μ€ λ‹¨ ν•λ‚μ ν•μ΄νΌνλΌλ―Έν„°λ§μ„ κ°€μ§€λ©°, μ‚¬μ©μκ°€ μ μ ν• κ°’μ„ κ²°μ •ν•  μ μλ„λ΅ λ•λ”λ‹¤. μ‚¬μ‹¤ DBSCAN μ—λ” \\( Eps, MinPts\\) λΌλ” λ‘ κ°μ νλΌλ―Έν„°κ°€ μ΅΄μ¬ν•μ§€λ§,  \\( MinPts \\) λ¥Ό κ³ μ •ν•κ³  \\( Eps \\) κ°’μ„ κ²°μ •ν•λ” λ°©λ²•μ΄ λ…Όλ¬Έ ν›„λ°λ¶€μ— μ μ‹λλ‹¤. λ‘μ§Έ, DBSCAN μ€ μ–΄λ–¤ λ¨μ–‘μ ν΄λ¬μ¤ν„°μ—λ„ λ€μ‘ν•  μ μλ‹¤. κ³µκ°„ λ°μ΄ν„°μ νΉμ„±μƒ ν΄λ¬μ¤ν„°λ” λ‹¤μ–‘ν• ν•νƒλ¥Ό κ°€μ§ μ μλ‹¤. μ§μ„  λ¨μ–‘μΌλ΅ κΈ°λ‹¤λ€ ν΄λ¬μ¤ν„°κ°€ μƒμ„±λ  μλ„ μκ³ , ν• μ μ„ μ¤‘μ‹¬μΌλ΅ λ‘¥κΈ€κ² λ¨μ—¬μμ„ μλ„ μλ‹¤. μ§μ‚¬κ°ν•μ΄λ‚ κ³΅μ„  λ¨μ–‘μ„ κ°–λ” κ²ƒλ„ κ°€λ¥ν•λ‹¤. DBSCAN μ€ λ°€λ„μ— κΈ°λ°ν•κΈ° λ•λ¬Έμ— λ‹¤μ–‘ν• ν΄λ¬μ¤ν„° λ¨μ–‘μ— λ€μ‘ν•  μ μλ‹¤. λ§μ§€λ§‰μΌλ΅, μ΄μ „κΉμ§€ μ μ‹λ μ•κ³ λ¦¬μ¦λ“¤μ— λΉ„ν•΄μ„ ν° λ°μ΄ν„°λ΅μ ν™•μ¥μ„±μ΄ μΆ‹λ‹¤.

## 2. A Density Based Notion of Clusters

μ΄ μ μ—μ„λ” ν΄λ¬μ¤ν„°, λ…Έμ΄μ¦ λ“± λ°€λ„κΈ°λ° ν΄λ¬μ¤ν„°λ§μ κΈ°λ³Έ κ°λ…λ“¤μ„ μ •μν•κ³ , μ΄μ— κΈ°λ°ν•μ—¬ μ•κ³ λ¦¬μ¦μ„ μ •λ‹Ήν™”ν•λ” λ³΄μ΅°μ •λ¦¬λ“¤μ„ μ†κ°ν•λ‹¤.

> **Definition 1. Eps-neighborhood of a point** 

> The \\(Eps\text{-}neighborhood\\) of a point \\(p\\), denoted by \\( N_{Eps}(p) \\), is defined by   \\( N_{Eps}(p) = \{ q \in D \vert dist(p, q) \leq Eps \} \\) 


    
![png](/assets/img/docs/2021-02-09-DBSCAN_files/2021-02-09-DBSCAN_8_0.png)
    


μ  \\( p \\) λ΅λ¶€ν„° \\( Eps \\) κ±°λ¦¬ μ΄λ‚΄μ— μλ” μ λ“¤μ μ§‘ν•©μ„ \\( p \\) μ μ…μ‹¤λ΅  μ΄μ›ƒμ΄λΌκ³  ν•λ‹¤.

> **Definition 2. directly density-reachable** 

> A point \\( p \\) is directly density-reachable from a point a point \\( q \\) wrt \\( Eps, MinPts \\) if 
\\( 1) \space p \in N_{Eps}(q) \\) and  
\\( 2) \space  \vert N_{Eps}(p)\vert \geq MinPts \\) (core point condition)


    
![png](/assets/img/docs/2021-02-09-DBSCAN_files/2021-02-09-DBSCAN_11_0.png)
    


\\( p \\) κ°€ \\( q \\) μ μ…μ‹¤λ΅  μ΄μ›ƒμ΄κ³  \\( q \\) μ μ…μ‹¤λ΅  μ΄μ›ƒμΈ μ μ΄ \\( MinPts \\) κ°λ³΄λ‹¤ λ§μΌλ©΄ \\( p \\) λ” \\( q \\) λ΅λ¶€ν„° directly density-reachable ν•λ‹¤. λ…Όλ¬Έμ—μ„λ” μ…μ‹¤λ΅  μ΄μ›ƒμΈ μ μ κ°―μκ°€ \\( MinPts \\) λ³΄λ‹¤ λ§μ€ μ λ“¤μ„ μ½”μ–΄ ν¬μΈνΈλΌκ³  λ§ν•λ‹¤.

> **Definition 3. density-reachable** 

> If \\( \exists \\) a chain of points \\( p_1, \cdots, p_n \\) such that \\( p_{i+1} \\) is directly density-reachable from \\( p_{i} \\), then \\( p_{n} \\) is ***density reachable*** from \\( p_{1} \\) 

    
![png](/assets/img/docs/2021-02-09-DBSCAN_files/2021-02-09-DBSCAN_14_0.png)
    


\\( p_{1} \\) μ—μ„ μ‹μ‘ν•΄ directly density-reachable ν• ν¬μΈνΈλ“¤μ„ μ—°μ†μ μΌλ΅ νƒ€κ³  κ°€μ„ \\( p_{n} \\) μ— λ„μ°©ν•  μ μλ‹¤λ©΄ \\( p_{n} \\) μ€  \\( p_{1} \\) μΌλ΅λ¶€ν„° density-reachable ν•λ‹¤. μ„ κ·Έλ¦Όμ—μ„λ” \\( p \\) μ—μ„ μ¶λ°ν•΄ ν•λ‚μ μ μ„ νƒ€κ³  \\( q \\) μ— λ„μ°©ν•  μ μμΌλ―€λ΅ \\(q \\) λ” \\( p \\) λ΅λ¶€ν„° density-reachable ν•μ§€λ§, κ·Έ λ°λ€λ” μ„±λ¦½ν•μ§€ μ•λ”λ‹¤. 

μ½”μ–΄ ν¬μΈνΈλ“¤ κ°„μ— density-reachable κ΄€κ³„λ” λ€μΉ­μ μ΄λ‹¤. μ½”μ–΄ ν¬μΈνΈ \\( p_{n} \\) μ΄  \\( p_{1} \\) μΌλ΅λ¶€ν„° density-reachable ν•λ‹¤κ³  κ°€μ •ν•΄λ³΄μ. μ¦‰ \\( p_{1}, \cdots, p_n  \\) μ€ λ¨λ‘ μ½”μ–΄ ν¬μΈνΈμ΄λ‹¤. κ·Έλ ‡λ‹¤λ©΄ \\( p_{n-1} \\) μΌλ΅λ¶€ν„° \\( p_{n} \\) μ— directly density-reachable ν•λ―€λ΅ μ΄ λ‘μ€ μ„λ΅μ μ…μ‹¤λ΅  μ΄μ›ƒμ΄λ‹¤. \\( p_n \\) μ΄ μ½”μ–΄ ν¬μΈνΈλΌκ³  κ°€μ •ν•μ€μΌλ―€λ΅ \\( p_{n} \\) μΌλ΅λ¶€ν„° \\( p_{n-1} \\) μ— directly density-reachable ν•λ‹¤. μ΄ κ³Όμ •μ„ λ°λ³µν•λ©΄ \\( p_1 \\) μ— λ„λ‹¬ν•  μ μλ‹¤.

> **Definition 4. density-connected** 

> If \\( \exists \\) a point \\( o \\) such that both \\( p \\) and \\( q \\) are density-reachable from \\( o \\), then \\( p \\) is ***dentisy-connected*** to \\( q \\)


    
![png](/assets/img/docs/2021-02-09-DBSCAN_files/2021-02-09-DBSCAN_17_0.png)
    


\\( p \\) μ™€ \\( q \\) κ°€ λ™μΌν• μ  \\( o \\) λ΅λ¶€ν„° density-reachable ν•λ‹¤λ©΄ \\( p \\) μ™€ \\( q \\) λ” density-connected ν•λ‹¤. μ΄ κ΄€κ³„λ” μ„μ— μ μ‹λ μ •μλ“¤κ³Ό λ‹¬λ¦¬ κ²½κ³„ ν¬μΈνΈλ“¤ κ°„μ—λ„ λ€μΉ­μ μΌλ΅ μ„±λ¦½ν•λ” κ΄€κ³„μ΄λ‹¤. κ·Έλ¦Όμ— μ£Όμ–΄μ§„ \\( p \\) μ™€ \\( q \\) λ” λ¨λ‘ κ²½κ³„ ν¬μΈνΈλ“¤μ΄μ§€λ§ λ¨λ‘ \\( o \\) λ΅λ¶€ν„° density-reachable ν•λ‹¤.

> **Definition 5. cluster** 

> Let \\( D \\) be a database of points. A ***cluster*** \\( C \\) is a non-empty subset of \\( D \\) satisfying the following conditions 
\\( 1) \space \forall p,q : \\) if \\( p \in C \\) and \\( q \\) is density-reachable from \\( p \\), then \\( q \in C \\) (Maximality)
\\( 1) \space \forall p,q \in C: \\) \\( p \\) is density-connected to \\( q \\) (Connectivity)


> **Definition 6. noise** 

> Let \\( C_1, \cdots C_k \\) be the clusters of the database \\( D \\). Then we define the ***noise*** as the set of points in the database \\( D \\) not belog to ant cluster \\( C_i \\), i.e, \\( noise = \{ p \in D \vert \forall i: p \notin C_i \} \\)


    
![png](/assets/img/docs/2021-02-09-DBSCAN_files/2021-02-09-DBSCAN_21_0.png)
    


1) ***Maximality***: \\( p \\)κ°€ ν΄λ¬μ¤ν„° \\( C \\) μ— μ†ν•λ‹¤λ©΄, \\( p \\) λ΅λ¶€ν„° density-reachable ν• λ¨λ“  μ λ“¤μ΄ \\( C \\)μ— μ†ν•λ‹¤.

2) ***Connectivity***: ν•λ‚μ ν΄λ¬μ¤ν„°μ— μ†ν•λ” λ¨λ“  μ λ“¤μ€ μ„λ΅ density-connected ν•λ‹¤.

μ„ λ‘ κ°€μ§€ μ΅°κ±΄μ„ λ§μ΅±ν•λ” μ λ“¤μ μ§‘ν•©μ„ **ν΄λ¬μ¤ν„°**λΌκ³  μ •μν•κ³ , μ–΄λ–¤ ν΄λ¬μ¤ν„°μ—λ„ μ†ν•μ§€ μ•λ” μ λ“¤μ„ **λ…Έμ΄μ¦**λΌκ³  μ •μν•λ‹¤. ν΄λ¬μ¤ν„°λ” κ³µμ§‘ν•©μ΄ μ•„λ‹λ―€λ΅ μµμ†ν• ν•λ‚μ μ  \\( o \\) λ¥Ό ν¬ν•¨ν•λ‹¤. λ‘μ§Έ μ΅°κ±΄μ— μν•΄ \\( o \\) λ” ν΄λ¬μ¤ν„° λ‚΄μ μ λ“¤κ³Ό density-connected ν•λ‹¤. Density-connected μ΅°κ±΄μ„ λ§μ΅±μ‹ν‚¤κΈ° μ„ν•΄μ„ ν΄λ¬μ¤ν„°λ” μµμ†ν• ν•λ‚μ μ½”μ–΄ ν¬μΈνΈλ¥Ό ν¬ν•¨ν•΄μ•Ό \\( p \\) λ¥Ό ν¬ν•¨ν•΄μ•Ό ν•λ‹¤. μ½”μ–΄ ν¬μΈνΈμ μ…μ‹¤λ΅  μ΄μ›ƒμ€ μµμ†ν• \\( MinPts \\) κ°μ μ›μ†λ΅ μ΄λ£¨μ–΄μ§€λ―€λ΅, ν΄λ¬μ¤ν„° μ—­μ‹ μµμ†ν• \\( MinPts \\) κ°μ μ›μ†λ¥Ό κ°–λ”λ‹¤. 

ν΄λ¬μ¤ν„°κ°€ μ½”μ–΄ ν¬μΈνΈ \\( p \\) λ¥Ό ν¬ν•¨ν•λ‹¤λ©΄, μ²«μ§Έ μ΅°κ±΄μ— λ”°λΌ \\( p \\) λ΅λ¶€ν„° density-reachable ν• μ λ“¤ μ—­μ‹ λ¨λ‘ κ°™μ€ ν΄λ¬μ¤ν„°μ— μ†ν•λ‹¤. μ‚¬μ‹¤ μ²«μ§Έ μ΅°κ±΄μ΄ λ§μ΅±λλ‹¤λ©΄ λ‘μ§Έ μ΅°κ±΄μ€ μλ™μΌλ΅ λ§μ΅±λλ‹¤. \\( p \\) λ΅λ¶€ν„° density-reachable ν• μ λ“¤μ„ λ¨λ‘ λ¨μ•„ λ†“λ”λ‹¤λ©΄, κ°κ°μ μ λ“¤μ€ \\( p \\) λ¥Ό λ§¤κ°λ΅ density-connected ν•κΈ° λ•λ¬Έμ΄λ‹¤. μ΄μ— λ”°λΌ μ²«λ²μ§Έ λ³΄μ΅°μ •λ¦¬κ°€ λ„μ¶λλ‹¤. ν•λ‚μ μ½”μ–΄ ν¬μΈνΈ \\( p \\) λ΅λ¶€ν„° density-reachable ν• μ λ“¤μ„ λ¨λ‘ λ¨μ•„λ†“μΌλ©΄ κ·Έκ²ƒμ΄ ν΄λ¬μ¤ν„°μ μ •μλ¥Ό λ§μ΅±ν•λ‹¤λ” λ‚΄μ©μ΄λ‹¤. 

> **Lemma 1.** 

> Let \\( p \\) be a point in \\( D \\) and \\(\vert  N_{eps}(p) \vert \geq MinPts \\). Then the  set \\( O = \{ o \vert o \in D, \space o \text{ is density-reachable from from } p \} \\) is a cluster.

ν΄λ¬μ¤ν„°μ—μ„ μ„μμ μ μ„ μ„ νƒν•΄ density-reachable ν• μ λ“¤μ„ λ¨λ‘ λ¨μ•„ λ†“μΌλ©΄ λ™μΌν• ν΄λ¬μ¤ν„°κ°€ λλ‹¤. ν΄λ¬μ¤ν„° \\( C \\) κ°€ μ„λ΅ λ‹¤λ¥Έ μ½”μ–΄ ν¬μΈνΈ \\( p \\) μ™€ \\( q \\) λ¥Ό ν¬ν•¨ν•λ‹¤κ³  κ°€μ •ν•΄λ³΄μ. μ²«μ§Έ μ΅°κ±΄μ— μν•΄ \\( p \\) μ™€ \\( q \\) λ” μ„λ΅ density-reachable ν•λ‹¤. κ·Έλ ‡λ‹¤λ©΄ \\( p \\) λ΅λ¶€ν„° density-reachable ν• μ  \\( o \\) λ” \\( q \\) λ΅λ¶€ν„°λ„ density-rechable ν•λ‹¤. \\( q, \cdots p, \cdots,  o \\) μ™€ κ°™μ΄ directly density-reachable ν• μ λ“¤μ μ²΄μΈμ΄ λ°λ“μ‹ μ΅΄μ¬ν•κΈ° λ•λ¬Έμ΄λ‹¤. λ°λ€μ κ²½μ°μ—λ„ λ§μ°¬κ°€μ§€μ΄λ‹¤. μ¦‰ μ„μμ μ  \\( o \in C \\) λ” μ„μμ μ½”μ–΄ ν¬μΈνΈ \\( p \in C \\) λ΅λ¶€ν„° density-reachable ν•λ‹¤.

> **Lemma 2.** 

> Let \\( C \\) be a cluster and let \\( p \\) be any point in \\( C \\) with \\( \vert  N_{eps}(p) \vert \geq MinPts  \\). Then \\( C \\) equals to the set \\( O = \{ o \vert o \in D, \space o \text{ is density-reachable from from } p \} \\).

## 4. DBSCAN

### 4.1. The Algorithm

μ„μ— μ μ‹λ λ³΄μ΅°μ •λ¦¬λ“¤μ— μν•λ©΄, λ°μ΄ν„°λ² μ΄μ¤μ—μ„ μμ°¨μ μΌλ΅ ν•λ‚μ μ μ„ κ³¨λΌ κ·Έλ΅λ¶€ν„° ν΄λ¬μ¤ν„°λ¥Ό ν™•μ¥ν•λ” λ°©μ‹μΌλ΅ λ¨λ“  ν΄λ¬μ¤ν„°λ¥Ό μ°Ύμ•„λ‚Ό μ μλ‹¤.  λ§μ•½ μ„ νƒλ μ μ΄ μ½”μ–΄ ν¬μΈνΈλΌλ©΄ density-reachable ν• μ λ“¤μ„ λ¨λ‘ μ°Ύμ•„ ν΄λ¬μ¤ν„°λ¥Ό μƒμ„±ν•λ‹¤. λ³΄μ΅°μ •λ¦¬μ— λ”°λΌ ν•λ‚μ ν΄λ¬μ¤ν„° λ‚΄μ—μ„λ” μ–΄λ–¤ μ μ„ μ„ νƒν•΄ ν΄λ¬μ¤ν„°λ¥Ό ν™•μ¥ν•κ±΄ λ™μΌν• κ²°κ³Όλ¥Ό μ–»μ„ μ μμΌλ―€λ΅ μ λ“¤μ μμ„λ” λ¬΄κ΄€ν•λ‹¤. λ§μ•½ μ„ νƒλ μ μ΄ μ½”μ–΄ ν¬μΈνΈκ°€ μ•„λ‹λΌλ©΄ λ‹¤μ ν¬μΈνΈλ΅ λ„μ–΄κ°„λ‹¤. μ‚¬μ‹¤ μ΄λ¬ν• μ§„ν–‰μ—μ„ μ£Όλ³€ ν¬μΈνΈλ“¤μ€ λ‘ κ° μ΄μƒμ ν΄λ¬μ¤ν„°μ— λ™μ‹μ— μ†ν•  μ μλ‹¤. ν•μ§€λ§ μ΄λ” λ§¤μ° λ“λ¬Έ κ²½μ°μ΄λ―€λ΅, λ¨Όμ € λ°κ²¬λ ν΄λ¬μ¤ν„°μ— ν• λ‹Ήν•λ” λ“± μ μ ν•κ² μ²λ¦¬ν•΄μ£Όλ©΄ λκ² λ‹¤.

μ΄μ  μ•κ³ λ¦¬μ¦μ„ νμ΄μ¬ μ½”λ“λ΅ μ®κ²¨λ³΄μ. κ°€λ¥ν• μμ‚¬μ½”λ“λ¥Ό κ·Έλ€λ΅ ν‘ν„ν•λ ¤κ³  ν–λ”λ°, λ¥λ ¥ λ¶€μ΅±μΌλ΅ μ™„μ „ν λ™μΌν•κ² ν‘ν„ν•μ§€λ” λ»ν–λ‹¤ π… μΌλ‹¨ ν•λ‚μ μ  μ£Όλ³€μ—μ„ μ ν΄λ¦¬λ“ κ±°λ¦¬λ΅ μ…μ‹¤λ΅  μ΄λ‚΄μ— μ΅΄μ¬ν•λ” μ λ“¤μ„ κ²€μƒ‰ν•λ” `regionQuery` ν•¨μλ¥Ό λ¨Όμ € μ •μν•μ. R-tree μ™€ κ°™μ€ μλ£κµ¬μ΅°λ¥Ό μ‚¬μ©ν•λ©΄ ν΄λ¬μ¤ν„°λ§μ„ \\(O ( n\log n ) \\) μ‹κ°„μ— μ™„λ£ν•  μ μλ‹¤λ”λ°, μ—­μ‹ λ¥λ ¥ λ¶€μ΅±μΌλ΅ λΈλ£¨νΈ ν¬μ¤ λ°©μ‹μ„ νƒν–λ‹¤.


```python
def regionQuery(setOfPoints, point, eps):
    mask = ((setOfPoints.x - point.x)**2 + (setOfPoints.y - point.y)**2) <= eps**2
    return setOfPoints[mask].index
```

λ‹¤μμ€ λ©”μΈ λ£¨ν”„λ¥Ό ν¬ν•¨ν•λ” `dbscan` ν•¨μμ΄λ‹¤. λ°μ΄ν„° μ§‘ν•©κ³Ό ν•μ΄νΌνλΌλ―Έν„°λ¥Ό λ°›μ•„μ„ ν΄λ¬μ¤ν„°λ§ κ²°κ³Όλ¥Ό λ°ν™ν•λ‹¤. λ°μ΄ν„°λ¥Ό μνν•λ©΄μ„ μ…μ‹¤λ΅  μ΄μ›ƒμ„ κ²€μƒ‰ν•΄ μ½”μ–΄ ν¬μΈνΈμΈμ§€λ¥Ό νλ‹¨ν•κ³ , μ½”μ–΄ ν¬μΈνΈκ°€ μ•„λ‹ κ²½μ°μ—λ” μ°μ„  λ…Έμ΄μ¦λ΅ λ‘”λ‹¤. λ§μ•½ λ‹¤λ¥Έ μ½”μ–΄ ν¬μΈνΈλ΅λ¶€ν„° density-reachable ν•λ‹¤λ” μ‚¬μ‹¤μ΄ λ°ν€μ§„λ‹¤λ©΄ κ·Έ λ• κ°’μ„ λ³€κ²½ν•΄μ£Όλ„λ΅ ν•λ‹¤. μ½”μ–΄ ν¬μΈνΈμΈ κ²½μ°μ—λ” `expandCluster` ν•¨μλ¥Ό νΈμ¶ν•μ—¬ ν•΄λ‹Ή μ μ—μ„ ν΄λ¬μ¤ν„°λ¥Ό ν™•μ¥ν•λ‹¤. λ…Όλ¬Έμ μμ‚¬μ½”λ“μ—μ„λ” ν¬μΈνΈμ μ…μ‹¤λ΅  μ΄μ›ƒμ„ κµ¬ν•λ” κΈ°λ¥λ¶€ν„° `expandCluster` ν•¨μκ°€ λ‹΄λ‹Ήν•λ‹¤. μ—¬κΈ°μ—μ„λ” μ‹λ“λ¥Ό κµ¬ν•λ” κ³Όμ •μ„ ν•¨μ λ°–μΌλ΅ λΉΌλ‚΄κ³ , `expandCluster` λ” ν΄λ¬μ¤ν„°λ¥Ό ν™•μ¥ν•λ” κΈ°λ¥λ§ λ‹΄λ‹Ήν•λ„λ΅ ν–λ‹¤.


```python
def dbscan(setOfPoints, eps, minPts):
    
    clusterId = 0  
    setOfPoints = setOfPoints.assign(clId = clusterId)  # UNCLASSIFIED: 0
    
    for i in tqdm(range(setOfPoints.shape[0])):  
        
        point = setOfPoints.loc[i]  # μ λ“¤μ„ λλ©΄μ„
        if point.clId == 0:  # μ•„μ§ ν΄λ¬μ¤ν„° ν• λ‹Ήμ΄ μ—†λ” μ μ΄λ©΄
            
            seeds = regionQuery(setOfPoints, point, eps)  # μ…μ‹¤λ΅  μ΄μ›ƒμ„ κ²€μƒ‰ν•λ‹¤
            
            if seeds.size < minPts:  # μ½”μ–΄ ν¬μΈνΈκ°€ μ•„λ‹λΌλ©΄
                setOfPoints.loc[seeds, "clId"] = -1  # μΌλ‹¨ λ…Έμ΄μ¦λ΅ λ‘κ³  λ„μ–΄κ°„λ‹¤
            
            else:  # μ½”μ–΄ ν¬μΈνΈλΌλ©΄
                clusterId += 1
                setOfPoints = expandCluster(  # ν•΄λ‹Ή ν¬μΈνΈμ—μ„ ν΄λ¬μ¤ν„°λ¥Ό ν™•μ¥ν•λ‹¤
                    setOfPoints = setOfPoints,
                    point = point,
                    seeds = seeds,
                    clId = clusterId,
                    eps = eps,
                    minPts = minPts
                )
    
    return setOfPoints.clId.values
```

`expandCluster` λ” λ°μ΄ν„° μ§‘ν•©κ³Ό ν•λ‚μ μ , κ·Έλ¦¬κ³  μ…μ‹¤λ΅  μ΄μ›ƒμ„ λ°›μ•„ μ μ„ μ¤‘μ‹¬μΌλ΅ ν΄λ¬μ¤ν„°λ¥Ό ν™•μ¥ν•λ‹¤. μ‹λ“λ“¤μ€ λ¨λ‘ μ£Όμ–΄μ§„ ν¬μΈνΈλ΅λ¶€ν„° directly density-reachable ν•λ―€λ΅ κ°™μ€ ν΄λ¬μ¤ν„°μ— μ†ν•λ‹¤. μ‹λ“λ“¤ μ¤‘μ— λλ‹¤λ¥Έ μ½”μ–΄ ν¬μΈνΈκ°€ μ΅΄μ¬ν•  μ μμΌλ―€λ΅, μ‹λ“λ¥Ό μμ°¨μ μΌλ΅ λλ©΄μ„ μ½”μ–΄ ν¬μΈνΈ μ—¬λ¶€λ¥Ό νμ•…ν•λ‹¤. λ§μ•½ μ½”μ–΄ ν¬μΈνΈλΌλ©΄ μ…μ‹¤λ΅  μ΄μ›ƒλ“¤μ— κ°™μ€ ν΄λ¬μ¤ν„°λ¥Ό ν• λ‹Ήν•κ³ , κ·Έμ¤‘μ—μ„ μ½”μ–΄ ν¬μΈνΈκ°€ λ  μ μλ” μ λ“¤μ„ λ‹¤μ‹ μ‹λ“μ λ§μ§€λ§‰μ— μ¶”κ°€ν•λ‹¤. λ”μ΄μƒ ν™•μ¥ κ°€λ¥ν• μ‹λ“κ°€ μ—†μ–΄μ§ λ•κΉμ§€ μ΄ κ³Όμ •μ„ λ°λ³µν•λ‹¤. μ–Έμ λ‚ λλΌμ§€λ§ μ•κ³ λ¦¬μ¦μ„ λ§μ΄λ‚ κΈ€λ΅ μ„¤λ…ν•λ‹¤λ”κ² μ°Έ μ‰½μ§€κ°€ μ•μ€ κ²ƒ κ°™λ‹¤.


```python
def expandCluster(setOfPoints, point, seeds, clId, eps, minPts):
    
    # point μ μ…μ‹¤λ΅  μ΄μ›ƒλ“¤μ€ λ¨λ‘ directly density-reachable ν•λ―€λ΅ κ°™μ€ ν΄λ¬μ¤ν„°λ΅ ν• λ‹Ήν•λ‹¤
    setOfPoints.loc[seeds, "clId"] = clId  
    
    # μ½”μ–΄ ν¬μΈνΈ μ‹λ“λ“¤μ„ λλ©΄μ„ ν΄λ¬μ¤ν„°λ¥Ό ν™•μ¥ν•λ‹¤
    seeds = seeds.drop(pd.Index([point.name]))  # point λ” μ΄λ―Έ ν™•μ¥ν–μΌλ―€λ΅ μ μ™Έν•λ‹¤
    
    while not seeds.empty:  # ν™•μ¥ν•  μ‹λ“κ°€ λ‚¨μ•„μλ‹¤λ©΄
        
        currentP = setOfPoints.loc[seeds[0]]  # μ‹λ“μ—μ„ μ²« ν¬μΈνΈ μ„ νƒ
        result = regionQuery(setOfPoints, currentP, eps)  # μ…μ‹¤λ΅  μ΄μ›ƒ κ²€μƒ‰
        
        
        if result.size >= minPts:  # μ½”μ–΄ ν¬μΈνΈμ΄λ©΄ μ—¬κΈ°μ—μ„ λ‹¤μ‹ ν™•μ¥ κ°€λ¥ν• μ λ“¤μ„ μ°Ύμ•„μ•Ό ν•λ‹¤.
            
            mask = setOfPoints.loc[result, "clId"] == 0  # μ•„μ§ ν΄λ¬μ¤ν„°κ°€ μ—†λ” μ λ“¤μ€ ν™•μ¥ κ°€λ¥μ„±μ΄ μλ‹¤
            seeds = seeds.append(result[mask])  # ν™•μ¥ κ°€λ¥μ„±μ΄ μλ” μ• λ“¤μ€ μ‹λ“μ— μ¶”κ°€
            setOfPoints.loc[result, "clId"] = clId  # ν΄λ¬μ¤ν„°λ¥Ό ν• λ‹Ήν•΄μ¤€λ‹¤. μ΄μ „μ— λ…Έμ΄μ¦λ΅ νλ‹¨λ μ λ“¤λ„ μ΄ κ³Όμ •μ—μ„ ν΄λ¬μ¤ν„°λ¥Ό ν• λ‹Ήλ°›λ”λ‹¤.
        
        seeds = seeds[1:]  # ν™•μ¥μ΄ μ™„λ£λ μ‹λ“λ” μ μ™Έν•λ‹¤
        
    return setOfPoints
```

μ΄μ  λ§λ“¤μ–΄μ§„ μ•κ³ λ¦¬μ¦μ„ ν…μ¤νΈν•΄λ³΄μ. [μ‚¬μ΄ν‚·λ° λ¬Έμ„](https://scikit-learn.org/stable/auto_examples/cluster/plot_cluster_comparison.html#sphx-glr-auto-examples-cluster-plot-cluster-comparison-py) μ™€ λ™μΌν•κ² μ› λ¨μ–‘, λ°λ‹¬ λ¨μ–‘μΌλ΅ λ¶„ν¬ν•λ” λ°μ΄ν„°λ¥Ό κ°κ° μƒμ„±ν•μ€λ‹¤. ν•μ΄νΌνλΌλ―Έν„° μ—­μ‹ λ¬Έμ„μ™€ λ™μΌν•κ² λ¶€μ—¬ν•κ³  ν΄λ¬μ¤ν„°λ¥Ό μ μ ν•κ² μ΅μ•„λ‚΄λ”μ§€ ν™•μΈν•΄λ³΄μ•λ‹¤. μ‚¬μ΄ν‚·λ° ν΄λμ¤λ³΄λ‹¤λ” ν›¨μ”¬ λλ¦¬μ§€λ§ μ•„λ¬΄νΌ κ²°κ³Όλ” μ μ΅μ•„λ‚΄λ” κ²ƒμ„ λ³Ό μ μλ‹¤. 


```python
n_samples = 1500
circles = datasets.make_circles(n_samples=n_samples, factor=.5, noise=.05)
moons = datasets.make_moons(n_samples=n_samples, noise=.05)
datas = [circles, moons]
```


```python
plt.figure(figsize=(12,6))
for i in range(2):
    sops = pd.DataFrame(data=datas[i][0], columns=["x", "y"])
    cls_labels = dbscan(sops, eps=0.15, minPts=5)
    plt.subplot(1, 2, i+1)
    sns.scatterplot(data=sops, x="x", y="y", hue=cls_labels.astype(str))
    plt.axis('equal')
else:
    plt.show()
```


    
![png](/assets/img/docs/2021-02-09-DBSCAN_files/2021-02-09-DBSCAN_32_2.png)
    


### 4.2. Determining the parameters Eps and MinPts

μ„μ—μ„ μ‚΄ν΄λ³Έκ²ƒμ²λΌ DBSCAN μ€ \\( Eps, MinPts \\) λΌλ” λ‘ κ°μ ν•μ΄νΌνλΌλ―Έν„°λ¥Ό κ°–λ”λ‹¤. μ—¬κΈ°μ—μ„λ” μ΄ ν•μ΄νΌνλΌλ―Έν„°λ“¤μ„ κ²°μ •ν•λ” λ°©λ²•μ— λ€ν•΄ μ•μ•„λ³Έλ‹¤. λ¨Όμ € \\( k\text{-}dist \\) λΌλ” ν•¨μλ¥Ό μ •μν•΄λ³΄μ.  \\( k\text{-}dist \\) λ” ν• μ  \\( p \\) λ¥Ό λ°›μ•„μ„ \\( p \\) λ΅λ¶€ν„° \\( k \\) λ²μ¨°λ΅ κ°€κΉμ΄ μ κΉμ§€μ κ±°λ¦¬λ¥Ό λ°ν™ν•λ” ν•¨μμ΄λ‹¤. κ°€λ Ή \\( 4\text{-}dist(p) \\) λ” \\( p \\) λ΅λ¶€ν„° λ„¤λ²μ§Έλ΅ κ°€κΉμ΄ μ κΉμ§€μ κ±°λ¦¬λ¥Ό λ°ν™ν•λ‹¤. 

μ΄μ  μΈμ΅° λ°μ΄ν„°λ¥Ό μƒμ„±ν• ν›„ \\( 4\text{-}dist \\) λ¥Ό μΈ΅μ •ν•΄μ„ μ •λ ¬ν•΄λ³΄μ. μ΄λ¥Ό κ·Έλν”„λ΅ κ·Έλ¦¬λ©΄ μ•„λμ λ‘λ²μ§Έ κ·Έλ¦Όκ³Ό κ°™μ€ λ¨μ–‘μ΄ λλ‹¤. λ€λµ 100λ²μ§Έ λ°μ΄ν„° κ·Όμ²μ—μ„ μ—λ³΄κ°€ λ‚νƒ€λ‚λ” κ²ƒμΌλ΅ λ³΄μΈλ‹¤. 100λ²μ§Έ λ°μ΄ν„°μ \\( 4\text{-}dist \\) λ” μ•½ `0.0412` μ •λ„κ°€ λλ‹¤. λ§μ•½ \\( Eps=0.0412, \space MinPts=4 \\) μ ν•μ΄νΌνλΌλ―Έν„°λ΅ DBSCAN μ„ μ‹¤ν–‰ν•λ‹¤λ©΄ μ μ„  μ°μΈ΅μ λ°μ΄ν„°λ“¤μ€ λ¨λ‘ μ½”μ–΄ ν¬μΈνΈκ°€ λ  κ²ƒμ΄λ‹¤. \\( 4\text{-}dist \\) ν•¨μκ°’μ΄ μ…μ‹¤λ΅ λ³΄λ‹¤ μ‘λ‹¤λ” κ²ƒμ€ μ΄ μ λ“¤μ μ…μ‹¤λ΅  μ΄μ›ƒμ΄ μµμ† 4κ°μ μ μ„ ν¬ν•¨ν•¨μ„ μλ―Έν•λ‹¤. λ°λ€λ΅ μ μ„  μΆμΈ΅μ λ°μ΄ν„°λ“¤μ€ κ²½κ³„ ν¬μΈνΈ νΉμ€ λ…Έμ΄μ¦κ°€ λ  κ²ƒμ΄λ‹¤. 

μ΄μ  μ°λ¦¬λ” μ»¤λΈμ μ—λ³΄ κ·Όμ²μ—μ„ μ…μ‹¤λ΅ μ„ μ΅°μ ν•λ” λ°©μ‹μΌλ΅ μ μ ν• νλΌλ―Έν„°λ¥Ό κ²°μ •ν•  μ μλ‹¤. \\( MinPts \\) λ” 4λ΅ κ³ μ •ν•λ”λ°, μ‹¤ν— κ²°κ³Ό \\( k\text{-}dist \\) μ ν•¨μκ°’μ€ \\( k > 4\\) μΈ κ²½μ°μ—λ” ν° μ°¨μ΄κ°€ μ—†κΈ° λ•λ¬Έμ΄λΌκ³  ν•λ‹¤. μ¦‰ \\( MinPts=4 \\) λ΅ κ³ μ •ν• μƒνƒμ—μ„ \\( sorted \space k\text{-}dist \space graph \\) λ¥Ό κ·Έλ ¤ μ μ ν• \\( Eps \\) κ°’μ„ κ²°μ •ν•  μ μλ‹¤.


```python
def k_dist(setOfPoints, k=4):
    setOfPoints = setOfPoints[['x', 'y']].values
    dist_matrix = np.linalg.norm(setOfPoints[:, None, :] - setOfPoints[None, :, :], axis=-1)
    dist = np.array(list(map(lambda x: x[x.argsort()][k-1], dist_matrix)))
    return np.array(dist)

sops = datasets.make_blobs(n_samples=1500, random_state=8)[0]
sops = pd.DataFrame(sops, columns=["x", "y"])
sops = sops.assign(kdist = k_dist(sops)).sort_values("kdist", ascending=False).reset_index()
```


    
![png](/assets/img/docs/2021-02-09-DBSCAN_files/2021-02-09-DBSCAN_36_1.png)
    


## 5. μ„μΈμ‹ μ–΄λ¦°μ΄ κµν†µμ‚¬κ³  ν΄λ¬μ¤ν„°λ§

μ‚¬μ‹¤ μλ¦¬μ‚¬νν•™μ΄λΌλ” ν•™λ¶€ μμ—… κ³Όμ μ—μ„ DBSCAN μ„ ν™μ©ν–λ μ μ΄ μλ‹¤. κ·Έλ•λ” `sklearn` μ„ μΌλ”λ°, λ™μΌν• μ‘μ—…μ„ μ§μ ‘ κµ¬ν„ν• `dbscan` ν•¨μλ΅ μ‹ν–‰ν•΄λ³΄μ•λ‹¤. μ‚¬μ©λ λ°μ΄ν„°λ” TAAS GIS μ‹μ¤ν…μ—μ„ μμ§‘ν• μ–΄λ¦°μ΄ κµν†µμ‚¬κ³  λ°μ΄ν„°μ΄λ‹¤. μ§€λ¦¬ λ°μ΄ν„° μ „μ²λ¦¬/ν›„μ²λ¦¬ κ΄€λ ¨ λ‚΄μ©μ΄ λ§μ•„ μμ„Έν• μ½”λ“λ” μƒλµν•μ€λ‹¤ π… 


<iframe src="/assets/img/docs/2021-02-09-DBSCAN_files/cluster.html" style="width:100%; height:600px; border:none">

</iframe>